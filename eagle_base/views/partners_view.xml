<?xml version="1.0"?>
<!--
  File: views/partners_view.xml
  Module: eagle_base

  Created by cyp@open-net.ch

  Copyright (c) 2014 Open-Net Ltd. All rights reserved.
-->
<openerp>
	<data>

		<record model="ir.ui.view" id="eagle_contract_partners_roles_inh">
			<field name="name">Eagle Contract Partners Roles view</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.view_partner_form"/>
            <field name="priority" eval="17"/>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="parent_id" position="after">
                    <field name="eagle_tab_profile_part_contracts_list" invisible="1"/>
                    <field name="eagle_parm_use_partners_roles" invisible="1"/>
                </field>
                <xpath expr="//notebook" position="inside">
                    <page string="Roles in contracts" attrs="{'invisible':[('eagle_parm_use_partners_roles','=',False)]}">
                        <field name="contract_roles_id" colspan="4" nolabel="1" widget="one2many" mode="tree">
                            <tree string=" " editable="bottom" version="7.0">
                                <field name="name"/>
                                <field name="contract_id"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Contracts list" attrs="{'invisible':[('eagle_tab_profile_part_contracts_list','=',False)]}">
                        <field name="eagle_contract_list" colspan="4" nolabel="1" mode="kanban">
                            <kanban>
                                <field name="state"/>
                                <field name="name"/>
                                <field name="date_start"/>
                                <field name="date_end"/>
                                <field name="partners"/>
                                <field name="cnt_partners"/>
                                <templates>
                                    <t t-name="kanban-box">
                                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                            <div class="oe_kanban_content">
                                                <div>
                                                    <b><field name="name"/></b>
                                                </div>
                                                <div style="padding-left: 0.5em">
                                                    <field name="date_start"/>
                                                    <t t-if="record.date_end.raw_value"> - </t>
                                                    <t t-if="record.date_end.raw_value and record.date_end.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
                                                    <span t-attf-class="#{red || ''}"><field name="date_end"/></span>
                                                </div>
                                                <t t-if="record.cnt_partners.raw_value">
                                                    <div>
                                                        Participants:<ul><t t-raw="record.cnt_partners.raw_value"/></ul>
                                                    </div>
                                                </t>
                                            </div>
                                            <div class="oe_clear"></div>
                                        </div>
                                    </t>
                                </templates>
                            </kanban>
                        </field>
                    </page>
				</xpath>
			</field>
		</record>

		<record model="ir.ui.view" id="eagle_partners_kanban_view">
			<field name="name">Eagle Partners Kanban view</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.res_partner_kanban_view"/>
            <field name="priority" eval="18"/>
			<field name="arch" type="xml">
                <field name="mobile" position="after">
                    <field name="eagle_contract_list"/>
                    <field name="eagle_contract_count"/>
                </field>
                <xpath expr="//div[@class='oe_kanban_partner_links']" position="inside">
                    <t t-if="record.eagle_contract_count.value == 1">
                        <t t-esc="record.eagle_contract_count.value"/> Contract
                    </t>
                    <t t-if="record.eagle_contract_count.value &gt; 1">
                        <t t-esc="record.eagle_contract_count.value"/> Contracts
                    </t>
                </xpath>
			</field>
		</record>

    </data>
</openerp>
