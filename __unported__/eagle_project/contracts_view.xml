<?xml version="1.0"?>
<!--
  File: contracts_view.xml
  Module: eagle_project

  Created by cyp@open-net.ch

  Copyright (c) 2011 Open-Net Ltd. All rights reserved.
-->
<openerp>
    <data>

    <!--
            Inherited contract form view from the Eagle Base module 
    -->
        <record model="ir.ui.view" id="eagle_project_view_contract_form_1">
            <field name="name">Eagle Project Contract View 1</field>
            <field name="model">eagle.contract</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_form"/>
            <field name="priority" eval="17"/>
            <field name="arch" type="xml">
                <page string="Other infos" position="before">
                    <page string="Project Tasks" attrs="{'invisible':[('tab_profile_project_tasks','=',False),('eagle_parm_show_all_meta_tabs','=',False)]}">
                        <field name="project_id" readonly="1"/>
                        <field name="tasks" context="{'current_eagle_project':project_id}">
                            <tree fonts="bold:message_unread==True" colors="grey:state in ('cancelled','done');blue:state == 'pending';red:date_deadline and (date_deadline&lt;current_date) and (state in ('draft','pending','open'))" string="Tasks">
                                <field name="message_unread" invisible="1"/>
                                <field name="sequence" string="Seq."/>
                                <field name="name"/>
                                <field name="project_id" icon="gtk-indent" domain="['|',('user_id','=',uid),('members','=',uid)]" invisible="context.get('user_invisible', False)"/>
                                <field name="user_id" invisible="context.get('user_invisible', False)"/>
                                <field name="delegated_user_id" invisible="context.get('show_delegated', True)"/>
                                <field name="total_hours" invisible="1"/>
                                <field name="planned_hours"/>
                                <field name="effective_hours" widget="float_time" sum="Spent Hours" invisible="1"/>
                                <field name="remaining_hours" widget="float_time" sum="Remaining Hours" on_change="onchange_remaining(remaining_hours,planned_hours)"/>
                                <field name="date_deadline"/>

                                <field name="stage_id" invisible="context.get('set_visible',False)"/>
                                <field name="state" invisible="1"/>
                                <field name="date_start" invisible="1"/>
                                <field name="date_end" invisible="1"/>
                                <field name="progress" widget="progressbar" invisible="context.get('set_visible',False)"/>
                            </tree>
                            <form string="Task edition" version="7.0">

                                <header>
                                    <!--
                                    <button name="do_open" string="Start Task" type="object"
                                            states="draft,pending" class="oe_highlight"/>
                                    <button name="do_draft" string="Draft" type="object"
                                            states="cancel,done"/>
                                    -->
                                    <button name="project_task_reevaluate" string="Reactivate" type="object"
                                            states="cancelled,done" context="{'button_reactivate':True}" groups="base.group_user"/>
                                    <button name="action_close" string="Done" type="object"
                                            states="draft,open,pending" groups="base.group_user"/>
                                    <button name="do_cancel" string="Cancel Task" type="object"
                                            states="draft,open,pending" groups="base.group_user"/>
                                    <field name="stage_id" widget="statusbar" clickable="True"/>
                                </header>

                                <group>
                                    <field name="name" select="1"/>
                                    <group>
                                        <field name="project_id"  on_change="onchange_project(project_id)" context="{'default_use_tasks':1}" domain="['|',('user_id','=',uid),('members','=',uid)]"/>
                                        <field name="user_id" attrs="{'readonly':[('state','in',['done', 'cancelled'])]}" options='{"no_open": True}'/>
                                        <field name="planned_hours" widget="float_time"
                                                groups="project.group_time_work_estimation_tasks"
                                                on_change="onchange_planned(planned_hours, effective_hours)"/>
                                    </group>
                                    <group>
                                        <field name="state" invisible="1"/>
                                        <field name="date_deadline" attrs="{'readonly':[('state','in',['done', 'cancelled'])]}"/>
                                        <field name="categ_ids" widget="many2many_tags"/>
                                        <field name="progress" widget="progressbar"
                                            groups="project.group_time_work_estimation_tasks" attrs="{'invisible':[('state','=','cancelled')]}"/>
                                    </group>
                                </group>

                                <notebook colspan="4">
                                    <page string="Information">
                                        <field name="description" attrs="{'readonly':[('state','=','done')]}" placeholder="Add a Description..."/>
                                        <field name="work_ids" attrs="{'invisible':[('state','in',['draft'])],'readonly':[('state','=','done')]}">
                                            <tree string="Task Work" editable="top">
                                                <field name="name"/>
                                                <field name="hours" widget="float_time" sum="Spent Hours"/>
                                                <field name="user_id"/>
                                                <field name="date"/>
                                                <field name="ons_hrtif_changed" />
                                                <field name="ons_hrtif_to_invoice" attrs="{'readonly':[('ons_hrtif_changed','=',False)]}"/>
                                                <field name="ons_hrtif_why_chg" attrs="{'readonly':[('ons_hrtif_changed','=',False)],'required':[('ons_hrtif_changed','&lt;&gt;',False)]}"/>
                                            </tree>
                                        </field>
                                        <group>
                                            <group class="oe_subtotal_footer oe_right" name="project_hours" groups="project.group_time_work_estimation_tasks">
                                                <field name="effective_hours" widget="float_time"/>
                                                <label for="remaining_hours" string="Remaining" groups="project.group_time_work_estimation_tasks"/>
                                                <div>
                                                    <field name="remaining_hours" widget="float_time" attrs="{'readonly':[('state','in',('done','cancelled'))]}" groups="project.group_time_work_estimation_tasks"/>
                                                </div>
                                                <field name="total_hours" widget="float_time" class="oe_subtotal_footer_separator"/>
                                            </group>
                                        </group>
                                        <div class="oe_clear"/>
                                    </page>
                                    <page groups="base.group_extended" string="Delegations">
                                        <separator string="Parent Tasks" colspan="4"/>
                                        <field colspan="4" height="150" name="parent_ids" nolabel="1"/>
                                        <separator string="Delegated tasks" colspan="4"/>
                                        <field colspan="4" height="150" name="child_ids" nolabel="1">
                                            <tree string="Delegated tasks">
                                                <field name="name"/>
                                                <field name="user_id"/>
                                                <field name="state"/>
                                                <field name="effective_hours" widget="float_time"/>
                                                <field name="progress" widget="progressbar"/>
                                                <field name="remaining_hours" widget="float_time"/>
                                                <field name="date_deadline"/>
                                            </tree>
                                        </field>
                                    </page>
            
                                    <page groups="base.group_extended" string="Extra Info" attrs="{'readonly':[('state','=','done')]}">
                                        <group>
                                            <separator string="Planning"/>
                                            <field name="priority"/>
                                            <field name="sequence"/>
                                        </group>
                                        <group>
                                            <separator string="Dates"/>
                                            <field name="date_start"/>
                                            <field name="date_end"/>
                                            <field name="create_date"/>
                                        </group>
                                        <separator string="Miscelleanous"/>
                                        <group>
                                            <field name="partner_id"/>
                                        </group>
                                        <group>
                                            <field name="company_id" select="1" groups="base.group_multi_company" widget="selection"/>
                                        </group>
                                        <separator colspan="4" string="Notes"/>
                                        <field name="notes"/>
                                    </page>
                                </notebook>
                            </form>
                        </field>
                        <field name="works" nolabel="1" colspan="4" context="{'filter_by_contract_id':active_id}">
                            <tree string="Task Work" editable="top">
                                <field name="task_id" domain="[('contract_id','=',context.get('filter_by_contract_id'))]"/>
                                <field name="name"/>
                                <field name="hours" widget="float_time" sum="Spent Hours"/>
                                <field name="user_id"/>
                                <field name="date"/>
                                <field name="ons_hrtif_changed" />
                                <field name="ons_hrtif_to_invoice" attrs="{'readonly':[('ons_hrtif_changed','=',False)]}"/>
                                <field name="ons_hrtif_why_chg" attrs="{'readonly':[('ons_hrtif_changed','=',False)],'required':[('ons_hrtif_changed','&lt;&gt;',False)]}"/>
                            </tree>
                        </field>
                        <div name="prj_buttons">
                        </div>
                    </page>
                    <page string="Analytic Entries" attrs="{'invisible':[('tab_profile_anal_entries','=',False),('eagle_parm_show_all_meta_tabs','=',False)]}">
                        <field name="account_analytic_account" colspan="2"/>
                        <newline/>
                        <field name="account_analytic_lines" nolabel="1" colspan="4"/>
                    </page>
                </page>
            </field>
        </record>
        <record model="ir.ui.view" id="eagle_project_view_contract_form_2">
            <field name="name">Eagle Project Contract View 2</field>
            <field name="model">eagle.contract</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_form"/>
            <field name="priority" eval="18"/>
            <field name="arch" type="xml">
                <group name="top" position="inside">
                    <field name="tab_profile_project_tasks" invisible="1"/>
                    <field name="tab_profile_anal_entries" invisible="1"/>
                </group>
                <group name="price_infos_nfos" position="inside">
                    <field name="remaining_ca"/>
                    <field name="ca_invoiced"/>
                </group>
                <xpath expr="//group[@name='price_infos_nfos']/field[@name='pricelist_id']" position="before">
                    <field name="fiscal_position"/>
                </xpath>
                <group name="price_infos_mnts" position="inside">
                    <field name="c_amount"/>
                    <field name="c_taxes"/>
                </group>
            </field>
        </record>


        <record model="ir.ui.view" id="eagle_view_contract_pos_form">
            <field name="name">Eagle Project Contract Position View Taxes</field>
            <field name="model">eagle.contract.position</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_pos_form"/>
            <field name="priority" eval="17"/>
            <field name="arch" type="xml">
                <field name="name" position="attributes">
                    <attribute name="on_change">onchange_product(name, qty, parent.date_start, parent.customer_id, parent.pricelist_id, start_of_period, parent.fiscal_position)</attribute>
                </field>
                <group name="info_bottom_taxes" position="inside">
                    <field name="tax_id" height="80" nolabel="1" colspan="2" attrs="{'readonly':[('state','=','done')]}" on_change="recomp_line(name,parent.customer_id,qty,list_price,discount,tax_id, parent.fiscal_position)"/>
                </group>
                <field name="qty" position="attributes">
                    <attribute name="on_change">recomp_line(name,parent.customer_id,qty,list_price,discount,tax_id, parent.fiscal_position)</attribute>
                </field>
                <field name="list_price" position="attributes">
                    <attribute name="on_change">recomp_line(name,parent.customer_id,qty,list_price,discount,tax_id, parent.fiscal_position)</attribute>
                </field>
                <field name="discount" position="attributes">
                    <attribute name="on_change">recomp_line(name,parent.customer_id,qty,list_price,discount,tax_id, parent.fiscal_position)</attribute>
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="eagle_view_contract_pos_sw_form">
            <field name="name">Eagle Project Contract Position Switched View Taxes</field>
            <field name="model">eagle.contract.position</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_pos_sw_form"/>
            <field name="priority" eval="17"/>
            <field name="arch" type="xml">
                <group name="info_bottom_taxes" position="inside">
                    <field name="tax_id" height="80" nolabel="1" colspan="2" attrs="{'readonly':[('state','=','done')]}" on_change="recomp_line_sw2(contract_id, name,qty,list_price,discount,tax_id)"/>
                </group>
                <field name="qty" position="attributes">
                    <attribute name="on_change">recomp_line_sw2(contract_id, name,qty,list_price,discount,tax_id)</attribute>
                </field>
                <field name="list_price" position="attributes">
                    <attribute name="on_change">recomp_line_sw2(contract_id, name,qty,list_price,discount,tax_id)</attribute>
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="eagle_project_view_contract_pos_tree">
            <field name="name">Eagle Project Contract Position List Amounts</field>
            <field name="model">eagle.contract.position</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_pos_tree"/>
            <field name="priority" eval="17"/>
            <field name="arch" type="xml">
                <field name="cl_total" position="before">
                    <field name="cl_amount" sum="Tax-free Amount" invisible="0"/>
                    <field name="cl_taxes" sum="Taxes" invisible="0"/>
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="eagle_project_view_contract_pos_indep_tree">
            <field name="name">Eagle Project Contract Position Indep List Amounts</field>
            <field name="model">eagle.contract.position</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_pos_indep_tree"/>
            <field name="priority" eval="17"/>
            <field name="arch" type="xml">
                <field name="cl_total" position="before">
                    <field name="cl_amount" sum="Tax-free Amount" invisible="0"/>
                    <field name="cl_taxes" sum="Taxes" invisible="0"/>
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="eagle_project_view_contract_pos_sales_tree">
            <field name="name">Eagle Project Contract Position Sales List Amounts</field>
            <field name="model">eagle.contract.position</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="eagle_base.eagle_view_contract_pos_sales_tree"/>
            <field name="priority" eval="17"/>
            <field name="arch" type="xml">
                <field name="cl_total" position="before">
                    <field name="cl_amount" sum="Tax-free Amount" invisible="0"/>
                    <field name="cl_taxes" sum="Taxes" invisible="0"/>
                </field>
            </field>
        </record>

    </data>
</openerp>
