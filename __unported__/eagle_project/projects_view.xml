<?xml version="1.0"?>
<!--
  File: projects_view.xml
  Module: eagle_project

  Created by cyp@open-net.ch

  Copyright (c) 2011 Open-Net Ltd. All rights reserved.
-->
<openerp>
	<data>

		<record model="ir.ui.view" id="eagle_view_project_form_inherit_1">
			<field name="name">Eagle Project Form 1</field>
			<field name="model">project.project</field>
			<field name="inherit_id" ref="project.edit_project"/>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<group name="misc" position="after">
                    <group col="2" colspan="2" name="contracts">
                        <separator colspan="2" string="Contract"/>
                        <field name="contract_id" select="1" groups="base.group_multi_company" string="Linked to"/>
                        <field name="project_use" select="1" groups="base.group_multi_company"/>
                    </group>
				</group>
			</field>
		</record>

        <record model="ir.ui.view" id="eagle_view_project_tree">
            <field name="name">Eagle Project List</field>
            <field name="model">project.project</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="red:date and (date&lt;current_date) and (state in ('open'));blue:state in ('draft','pending');grey: state in ('close','cancelled')" string="Projects">
                    <field name="sequence" invisible="1"/>
                    <field name="date" invisible="1"/>
                    <field name="name" string="Project Name"/>
                    <field name="user_id" string="Project Manager"/>
                    <field name="partner_id" string="Partner"/>
                    <field name="planned_hours" widget="float_time"/>
                    <field name="total_hours" widget="float_time"/>
                    <field name="effective_hours" widget="float_time"/>
                    <field name="progress_rate" widget="progressbar"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

		<act_window 
			domain="[('contract_id', '=', active_id)]" 
			id="act_contract_2_all_tasks"
			name="All Tasks"
			res_model="project.task"
			src_model="eagle.contract"/>

		<act_window 
			domain="[('contract_id', '=', active_id),('user_id','=',uid)]" 
			id="act_contract_2_my_tasks"
			name="My Tasks"
			res_model="project.task"
			src_model="eagle.contract"/>

		<record model="ir.ui.view" id="eagle_view_task_work_inherit">
			<field name="name">Eagle Project Task Works View</field>
			<field name="model">project.task.work</field>
			<field name="inherit_id" ref="project.view_task_work_tree"/>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<field name="user_id" position="after">
					<field name="ons_hrtif_changed" />
					<field name="ons_hrtif_to_invoice" attrs="{'readonly':[('ons_hrtif_changed','=',False)]}"/>
					<field name="ons_hrtif_why_chg" attrs="{'readonly':[('ons_hrtif_changed','=',False)],'required':[('ons_hrtif_changed','&lt;&gt;',False)]}"/>
				</field>
			</field>
		</record>

		<record model="ir.ui.view" id="eagle_view_task_work_inherit">
			<field name="name">Eagle Project Task View</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="project.view_task_form2"/>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="date" position="after">
					<field name="ons_hrtif_changed" />
					<field name="ons_hrtif_to_invoice" attrs="{'readonly':[('ons_hrtif_changed','=',False)]}"/>
					<field name="ons_hrtif_why_chg" attrs="{'readonly':[('ons_hrtif_changed','=',False)],'required':[('ons_hrtif_changed','&lt;&gt;',False)]}"/>
				</field>
                <xpath expr="/form/sheet/notebook/page[@string='Extra Info']/group[1]/field[@name='partner_id']" position="after">
                    <field name="contract_id"/>
                </xpath>
			</field>
		</record>

		<record model="ir.ui.view" id="eagle_project_tasks_tree_inherit_1">
			<field name="name">Eagle Project Tasks List Inherit 1</field>
			<field name="model">project.task</field>
			<!--<field name="inherit_id" ref="project.view_task_tree2"/>-->
			<field name="priority" eval="100"/>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Tasks">
                    <field name="name"/>
					<field name="ons_current_user"/>
					<button name="in_progress" string="In progress" type="object" icon="terp-camera_test"/>
					<button name="stop_progress" string="Stop progressing" type="object" icon="gtk-close"/>
				</tree>
			</field>
		</record>

		<record model="ir.ui.view" id="eagle_project_tasks_view_inherit_1">
			<field name="name">Eagle Project Tasks View Inherit 1</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="project.view_task_form2"/>
			<field name="priority" eval="22"/>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<field name="progress" position="after">
					<group colspan="4" col="6">
						<group colspan="4" col="4">
							<field name="ons_current_user" colspan="2" readonly="1"/>
							<field name="ons_date_start" colspan="2" readonly="1"/>
							<field name="is_in_progress" invisible="1"/>
						</group>
						<group colspan="2" col="2">
							<group colspan="2" col="2" attrs="{'invisible':[('is_in_progress','=',True)]}">
								<button name="in_progress" string="In progress" type="object" icon="terp-camera_test"/>
							</group>
							<group colspan="2" col="2" attrs="{'invisible':[('is_in_progress','=',False)]}">
								<button name="stop_progress" string="Stop progressing" type="object" icon="gtk-close"/>
							</group>
						</group>
					</group>
				</field>
			</field>
		</record>

		<record model="ir.actions.act_window" id="eagle_project_hr_monitoring_current_tasks">
            <field name="name">Eagle Project Monitoring Tasks</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">project.task</field>
            <field name="view_id" eval="eagle_project_tasks_tree_inherit_1"/>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="project.view_task_search_form"/>
            <field name="context">{"search_default_act_to":uid,"search_default_current":1}</field>
            <field name="domain">[('is_in_progress','=','True')]</field>
        </record>

    	<!-- EAGLE TASK TEMPLATE: TREE definition -->
        <record model="ir.ui.view" id="eagle_project_task_tmpl_tree">
            <field name="name">Eagle Project Task Template List</field>
            <field name="model">eagle.template.task</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Task templates">
                    <field name="sequence" />
                    <field name="name"/>
                    <field name="project_use"/>
                    <field name="stage_id"/>
                </tree>
            </field>
        </record>

    	<!-- EAGLE TASK TEMPLATE: FORM definition -->
        <record model="ir.ui.view" id="eagle_project_task_tmpl_form">
            <field name="name">Eagle Project Task Template View</field>
            <field name="model">eagle.template.task</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Task template">
                    <field name="project_use"/>
                    <field name="sequence" />
                    <field name="name"/>
                    <field name="stage_id"/>
                </form>
            </field>
        </record>

    	<!-- EAGLE TASK TEMPLATE: Search definition -->
        <record model="ir.ui.view" id="eagle_project_task_tmpl_search">
            <field name="name">Eagle Project Task Template Search</field>
            <field name="model">eagle.template.task</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search task templates">
                    <group>
                        <field name="name"/>
                    </group>
                    <group expand="1" string="Group By...">
                        <filter string="Project Use" context="{'group_by': 'project_use'}" icon="terp-stock_effects-object-colorize"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="eagle_project_action_task_templates">
            <field name="name">Task templates</field>
            <field name="res_model">eagle.template.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="eagle_project_task_tmpl_tree"/>
            <field name="search_view_id" ref="eagle_project_task_tmpl_search"/>
        </record>

	</data>
</openerp>
